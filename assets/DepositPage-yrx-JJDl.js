import{_ as e,a as t,c as n,f as r,i,n as a,o,r as s,v as c}from"./index-BtQzElyV.js";var l=c(e()),u=c(s());function d(){let{currentUser:e}=a(),[s,c]=(0,l.useState)(``),[d,f]=(0,l.useState)(``),[p,m]=(0,l.useState)(null),[h,g]=(0,l.useState)(null),[_,v]=(0,l.useState)(!1),[y,b]=(0,l.useState)(``),[x,S]=(0,l.useState)(``),[C,w]=(0,l.useState)([]),[T,E]=(0,l.useState)(!0);(0,l.useEffect)(()=>{(async()=>{if(e){E(!0);try{let t=await n(o(i,`deposits`)),r=[];t.forEach(t=>{let n={id:t.id,...t.data()};n.userId===e.uid&&r.push(n)}),r.sort((e,t)=>e.timestamp?t.timestamp?t.timestamp.toDate()-e.timestamp.toDate():-1:1),w(r)}catch(e){console.error(`Error fetching deposits:`,e),S(`Failed to load deposit history`)}finally{E(!1)}}})()},[e]);let D=e=>{let t=e.target.files[0];if(t){if(![`image/jpeg`,`image/png`,`image/webp`].includes(t.type)){S(`Only JPG/PNG/WebP images are allowed`);return}m(t),g(URL.createObjectURL(t))}},O=async a=>{if(a.preventDefault(),!s||!d||!p){S(`Please fill all fields and upload an image`);return}v(!0),S(``),b(``);try{let a=new FormData;a.append(`file`,p),a.append(`upload_preset`,`Shop-preset`);let l=await(await fetch(`https://api.cloudinary.com/v1_1/dlrxomdfh/image/upload`,{method:`POST`,body:a})).json();if(!l.secure_url)throw Error(`Image upload failed`);await t(o(i,`deposits`),{userId:e.uid,amount:parseFloat(s),message:d,imageUrl:l.secure_url,timestamp:r(),status:`pending`}),c(``),f(``),m(null),g(null),b(`Deposit submitted successfully!`);let u=await n(o(i,`deposits`)),h=[];u.forEach(t=>{let n={id:t.id,...t.data()};n.userId===e.uid&&h.push(n)}),h.sort((e,t)=>e.timestamp?t.timestamp?t.timestamp.toDate()-e.timestamp.toDate():-1:1),w(h)}catch(e){console.error(e),S(e.message||`Failed to submit deposit`)}finally{v(!1)}},k=e=>{if(!e)return``;let t=e.toDate(),n=t.getHours().toString().padStart(2,`0`),r=t.getMinutes().toString().padStart(2,`0`),i=t.getDate(),a=t.toLocaleString(`default`,{month:`short`});return`${n}:${r} · ${i} ${a}`};return(0,u.jsx)(`div`,{className:`whatsapp-container`,children:(0,u.jsxs)(`div`,{className:`chat-container`,children:[x&&(0,u.jsx)(`div`,{className:`alert alert-error`,children:x}),y&&(0,u.jsxs)(`div`,{className:`alert alert-success`,children:[(0,u.jsx)(`span`,{className:`alert-success-icon`,children:`✓✓`}),` `,y]}),T?(0,u.jsx)(`div`,{className:`loading-indicator`,children:(0,u.jsxs)(`div`,{className:`loading-dots`,children:[(0,u.jsx)(`div`,{className:`loading-dot`}),(0,u.jsx)(`div`,{className:`loading-dot`}),(0,u.jsx)(`div`,{className:`loading-dot`})]})}):C.length===0?(0,u.jsx)(`div`,{className:`empty-state`,children:`No deposit history yet`}):C.map(e=>(0,u.jsx)(`div`,{className:`message-bubble`,children:(0,u.jsx)(`div`,{className:`message-bubble-content`,children:(0,u.jsxs)(`div`,{className:`message-bubble-bg`,children:[e.imageUrl&&(0,u.jsx)(`div`,{children:(0,u.jsx)(`img`,{src:e.imageUrl,alt:`Deposit receipt`,className:`message-image`})}),(0,u.jsxs)(`div`,{className:`message-text`,children:[(0,u.jsxs)(`p`,{className:`message-amount`,children:[`$`,e.amount]}),(0,u.jsx)(`p`,{className:`message-note`,children:e.message}),(0,u.jsx)(`p`,{className:`message-timestamp`,children:k(e.timestamp)})]})]})})},e.id)),(0,u.jsxs)(`div`,{className:`form-container`,children:[(0,u.jsx)(`h2`,{className:`form-title`,children:`Submit New Deposit`}),(0,u.jsxs)(`form`,{onSubmit:O,className:`form-group`,children:[(0,u.jsx)(`input`,{type:`number`,placeholder:`Amount deposited`,value:s,onChange:e=>c(e.target.value),className:`form-input`,min:`0`,step:`0.01`,required:!0}),(0,u.jsx)(`input`,{type:`text`,placeholder:`Message`,value:d,onChange:e=>f(e.target.value),className:`form-input`}),(0,u.jsx)(`input`,{type:`file`,accept:`image/*`,onChange:D,className:`form-input`}),h&&(0,u.jsx)(`img`,{src:h,alt:`Preview`,className:`image-preview`}),(0,u.jsx)(`button`,{type:`submit`,disabled:_,className:`form-button`,children:_?`Submitting...`:`Submit Deposit`})]})]})]})})}export{d as default};