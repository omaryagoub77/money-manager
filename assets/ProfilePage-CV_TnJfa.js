import{_ as e,a as t,b as n,g as r,i,l as a,n as o,o as s,p as c,r as l,s as u,x as d}from"./index-JaA9RlRA.js";import{t as f}from"./Alert-BmDM5GAo.js";var p=d(n()),m=d(l()),h=()=>{let{currentUser:n,logout:l}=o(),[d,h]=(0,p.useState)(!0),[g,_]=(0,p.useState)({fullName:``,age:``,email:``,phoneNumber:``,gender:`male`,imageUrl:``,momoNumber:``,creditCardNumber:``}),[v,y]=(0,p.useState)(!1),[b,x]=(0,p.useState)(null),[S,C]=(0,p.useState)(``),[w,T]=(0,p.useState)(null),[E,D]=(0,p.useState)(null),[O,k]=(0,p.useState)(null),[A,j]=(0,p.useState)(!1),[M,N]=(0,p.useState)(``),[P,F]=(0,p.useState)(``),I=`dlrxomdfh`,L=`Shop-preset`;(0,p.useEffect)(()=>{(async()=>{if(n)try{let t=c(s(i,`users`),e(`uid`,`==`,n.uid)),r=await a(t);if(!r.empty){let e=r.docs[0],t=e.data();_({fullName:t.fullName||``,age:t.age||``,email:t.email||``,phoneNumber:t.phoneNumber||``,gender:t.gender||`male`,imageUrl:t.imageUrl||``,momoNumber:t.momoNumber||``,creditCardNumber:t.creditCardNumber||``}),T(e.id),h(!1)}}catch(e){console.error(`Error fetching user profile:`,e)}})()},[n]);let R=e=>{let{name:t,value:n}=e.target;if(t===`momoNumber`||t===`creditCardNumber`){let e=n.replace(/[^0-9]/g,``);_(n=>({...n,[t]:e}))}else _(e=>({...e,[t]:n}))},z=e=>{let t=e.target.files[0];if(t){if(![`image/jpeg`,`image/png`,`image/webp`].includes(t.type)){F(`Only JPG/PNG/WebP images are allowed`);return}D(t),k(URL.createObjectURL(t)),F(``)}},B=async()=>{if(!E)return null;try{let e=new FormData;e.append(`file`,E),e.append(`upload_preset`,L);let t=await(await fetch(`https://api.cloudinary.com/v1_1/${I}/image/upload`,{method:`POST`,body:e})).json();if(!t.secure_url)throw Error(`Image upload failed`);return t.secure_url}catch(e){return console.error(e),F(e.message||`Failed to upload image`),null}},V=async e=>{if(e.preventDefault(),!g.fullName||!g.age||!g.email||!g.phoneNumber||!g.momoNumber||!g.creditCardNumber){F(`Please fill all required fields`);return}if(!/^\d+$/.test(g.momoNumber)){F(`MoMo Number must contain only numbers`);return}if(!/^\d+$/.test(g.creditCardNumber)){F(`Credit Card Number must contain only numbers`);return}j(!0),F(``),N(``);try{let e=g.imageUrl;if(E){let t=await B();if(!t){j(!1);return}e=t}let a={...g,imageUrl:e,updatedAt:new Date};if(w)await r(u(i,`users`,w),a);else{let e=await t(s(i,`users`),{...a,uid:n.uid,createdAt:new Date});T(e.id)}_(t=>({...t,imageUrl:e})),D(null),k(null),N(`Profile updated successfully!`),h(!1)}catch(e){console.error(`Error saving profile data:`,e),F(`Failed to save profile. Please try again.`)}finally{j(!1)}},H=(e,t)=>{x(e),C(t)},U=async()=>{if(!(!b||!w)){if((b===`momoNumber`||b===`creditCardNumber`)&&S&&!/^\d+$/.test(S)){F(`${b===`momoNumber`?`MoMo Number`:`Credit Card Number`} must contain only numbers`);return}try{await r(u(i,`users`,w),{[b]:S,updatedAt:new Date}),_(e=>({...e,[b]:S})),x(null),C(``),N(`Field updated successfully!`)}catch(e){console.error(`Error updating field:`,e),F(`Failed to update. Please try again.`)}}},W=()=>{x(null),C(``)};return d?(0,m.jsx)(`div`,{className:`whatsapp-container `,children:(0,m.jsx)(`div`,{className:`main-content`,children:(0,m.jsxs)(`div`,{className:`card`,children:[(0,m.jsx)(`div`,{className:`card-header`,children:(0,m.jsx)(`h1`,{className:`card-title`,children:`Complete Your Profile`})}),(0,m.jsxs)(`div`,{className:`card-body`,children:[P&&(0,m.jsx)(`div`,{className:`alert alert-error`,children:P}),M&&(0,m.jsxs)(`div`,{className:`alert alert-success`,children:[(0,m.jsx)(`span`,{children:M}),(0,m.jsx)(`span`,{className:`alert-success-icon`,children:`âœ“âœ“`})]}),(0,m.jsxs)(`form`,{onSubmit:V,className:`profile-form`,children:[(0,m.jsxs)(`div`,{className:`profile-image-container`,children:[(0,m.jsx)(`div`,{className:`profile-image`,children:O?(0,m.jsx)(`img`,{src:O,alt:`Preview`,className:`profile-image-img`}):g.imageUrl?(0,m.jsx)(`img`,{src:g.imageUrl,alt:`Profile`,className:`profile-image-img`}):(0,m.jsx)(`span`,{className:`profile-image-initial`,children:g.fullName?.charAt(0).toUpperCase()||`U`})}),(0,m.jsxs)(`label`,{className:`image-upload-button`,children:[(0,m.jsx)(`span`,{className:`image-upload-icon`,children:`ðŸ“·`}),(0,m.jsx)(`span`,{children:E?`Change Photo`:`Upload Photo`}),(0,m.jsx)(`input`,{type:`file`,accept:`image/*`,onChange:z,className:`hidden`})]})]}),(0,m.jsxs)(`div`,{className:`form-group`,children:[(0,m.jsx)(`label`,{className:`form-label`,htmlFor:`fullName`,children:`Full Name`}),(0,m.jsx)(`input`,{className:`form-input`,id:`fullName`,name:`fullName`,type:`text`,placeholder:`Enter your full name`,value:g.fullName,onChange:R,required:!0})]}),(0,m.jsxs)(`div`,{className:`form-group`,children:[(0,m.jsx)(`label`,{className:`form-label`,htmlFor:`age`,children:`Age`}),(0,m.jsx)(`input`,{className:`form-input`,id:`age`,name:`age`,type:`number`,placeholder:`Enter your age`,value:g.age,onChange:R,required:!0})]}),(0,m.jsxs)(`div`,{className:`form-group`,children:[(0,m.jsx)(`label`,{className:`form-label`,htmlFor:`email`,children:`Email`}),(0,m.jsx)(`input`,{className:`form-input`,id:`email`,name:`email`,type:`email`,placeholder:`Enter your email`,value:g.email,onChange:R,required:!0})]}),(0,m.jsxs)(`div`,{className:`form-group`,children:[(0,m.jsx)(`label`,{className:`form-label`,htmlFor:`phoneNumber`,children:`Phone Number`}),(0,m.jsx)(`input`,{className:`form-input`,id:`phoneNumber`,name:`phoneNumber`,type:`tel`,placeholder:`Enter your phone number`,value:g.phoneNumber,onChange:R,required:!0})]}),(0,m.jsxs)(`div`,{className:`form-group`,children:[(0,m.jsx)(`label`,{className:`form-label`,htmlFor:`momoNumber`,children:`MoMo Number`}),(0,m.jsx)(`input`,{className:`form-input`,id:`momoNumber`,name:`momoNumber`,type:`text`,placeholder:`Enter your MoMo number`,value:g.momoNumber,onChange:R,required:!0})]}),(0,m.jsxs)(`div`,{className:`form-group`,children:[(0,m.jsx)(`label`,{className:`form-label`,htmlFor:`creditCardNumber`,children:`Credit Card Number`}),(0,m.jsx)(`input`,{className:`form-input`,id:`creditCardNumber`,name:`creditCardNumber`,type:`text`,placeholder:`Enter your credit card number`,value:g.creditCardNumber,onChange:R,required:!0})]}),(0,m.jsxs)(`div`,{className:`form-group`,children:[(0,m.jsx)(`label`,{className:`form-label`,children:`Gender`}),(0,m.jsxs)(`div`,{className:`radio-group`,children:[(0,m.jsxs)(`label`,{className:`radio-label`,children:[(0,m.jsx)(`input`,{type:`radio`,name:`gender`,value:`male`,checked:g.gender===`male`,onChange:R,className:`radio-input`}),(0,m.jsx)(`span`,{className:`radio-label-text`,children:`Male`})]}),(0,m.jsxs)(`label`,{className:`radio-label`,children:[(0,m.jsx)(`input`,{type:`radio`,name:`gender`,value:`female`,checked:g.gender===`female`,onChange:R,className:`radio-input`}),(0,m.jsx)(`span`,{className:`radio-label-text`,children:`Female`})]})]})]}),(0,m.jsx)(`div`,{className:`form-actions`,children:(0,m.jsx)(`button`,{type:`submit`,disabled:A,className:`btn btn-primary`,children:A?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(`div`,{className:`loading-spinner`,children:[(0,m.jsx)(`div`,{className:`loading-spinner-inner`}),(0,m.jsx)(`div`,{className:`loading-spinner-outer`})]}),`Saving...`]}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(`span`,{className:`button-icon`,children:`âœ“`}),`Save Profile`]})})})]})]})]})})}):(0,m.jsx)(`div`,{className:`whatsapp-container`,children:(0,m.jsx)(`div`,{className:`main-content`,children:(0,m.jsxs)(`div`,{className:`card`,children:[(0,m.jsx)(`div`,{className:`card-header`,children:(0,m.jsx)(`h1`,{className:`card-title`,children:`Your Profile`})}),(0,m.jsxs)(`div`,{className:`card-body`,children:[P&&(0,m.jsx)(f,{type:`error`,message:P}),M&&(0,m.jsx)(f,{type:`success`,message:M}),(0,m.jsxs)(`div`,{className:`profile-header`,children:[(0,m.jsxs)(`div`,{className:`profile-avatar`,children:[g.imageUrl?(0,m.jsx)(`img`,{src:g.imageUrl,alt:`Profile`,className:`profile-avatar-img`}):g.fullName?.charAt(0).toUpperCase()||`U`,(0,m.jsx)(`button`,{onClick:()=>document.getElementById(`profile-image-input`).click(),className:`edit-avatar-button`,disabled:A,children:A?(0,m.jsxs)(`div`,{className:`loading-spinner`,children:[(0,m.jsx)(`div`,{className:`loading-spinner-inner`}),(0,m.jsx)(`div`,{className:`loading-spinner-outer`})]}):(0,m.jsx)(`span`,{children:`âœï¸`})}),(0,m.jsx)(`input`,{id:`profile-image-input`,type:`file`,accept:`image/*`,className:`hidden`,onChange:async e=>{let t=e.target.files[0];if(t){if(![`image/jpeg`,`image/png`,`image/webp`].includes(t.type)){F(`Only JPG/PNG/WebP images are allowed`);return}j(!0),F(``);try{let e=new FormData;e.append(`file`,t),e.append(`upload_preset`,L);let n=await(await fetch(`https://api.cloudinary.com/v1_1/${I}/image/upload`,{method:`POST`,body:e})).json();if(!n.secure_url)throw Error(`Image upload failed`);await r(u(i,`users`,w),{imageUrl:n.secure_url,updatedAt:new Date}),_(e=>({...e,imageUrl:n.secure_url})),N(`Profile image updated successfully!`)}catch(e){console.error(e),F(e.message||`Failed to upload image`)}finally{j(!1),e.target.value=``}}}})]}),(0,m.jsx)(`h2`,{className:`profile-name`,children:g.fullName||`User`}),(0,m.jsxs)(`p`,{className:`profile-id`,children:[`User ID: `,n?.uid]})]}),(0,m.jsxs)(`div`,{className:`info-section`,children:[(0,m.jsx)(`h3`,{className:`info-title`,children:`Account Information`}),(0,m.jsxs)(`div`,{className:`info-list`,children:[(0,m.jsx)(`div`,{className:`info-item`,children:(0,m.jsxs)(`div`,{className:`info-row`,children:[(0,m.jsx)(`span`,{className:`info-label `,children:`Full Name:`}),(0,m.jsx)(`div`,{className:`info-value-container`,children:b===`fullName`?(0,m.jsxs)(`div`,{className:`edit-form`,children:[(0,m.jsx)(`input`,{type:`text`,value:S,onChange:e=>C(e.target.value),className:`edit-input`}),(0,m.jsx)(`button`,{onClick:U,className:`edit-save-button`,children:`âœ“`}),(0,m.jsx)(`button`,{onClick:W,className:`edit-cancel-button`,children:`âœ•`})]}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(`span`,{className:`info-value`,children:g.fullName}),(0,m.jsx)(`button`,{onClick:()=>H(`fullName`,g.fullName),className:`edit-button`,children:`âœï¸`})]})})]})}),(0,m.jsx)(`div`,{className:`info-item`,children:(0,m.jsxs)(`div`,{className:`info-row`,children:[(0,m.jsx)(`span`,{className:`info-label`,children:`Age:`}),(0,m.jsx)(`div`,{className:`info-value-container`,children:b===`age`?(0,m.jsxs)(`div`,{className:`edit-form`,children:[(0,m.jsx)(`input`,{type:`number`,value:S,onChange:e=>C(e.target.value),className:`edit-input`}),(0,m.jsx)(`button`,{onClick:U,className:`edit-save-button`,children:`âœ“`}),(0,m.jsx)(`button`,{onClick:W,className:`edit-cancel-button`,children:`âœ•`})]}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(`span`,{className:`info-value`,children:g.age}),(0,m.jsx)(`button`,{onClick:()=>H(`age`,g.age),className:`edit-button`,children:`âœï¸`})]})})]})}),(0,m.jsx)(`div`,{className:`info-item`,children:(0,m.jsxs)(`div`,{className:`info-row`,children:[(0,m.jsx)(`span`,{className:`info-label`,children:`Email:`}),(0,m.jsx)(`div`,{className:`info-value-container`,children:b===`email`?(0,m.jsxs)(`div`,{className:`edit-form`,children:[(0,m.jsx)(`input`,{type:`email`,value:S,onChange:e=>C(e.target.value),className:`edit-input`}),(0,m.jsx)(`button`,{onClick:U,className:`edit-save-button`,children:`âœ“`}),(0,m.jsx)(`button`,{onClick:W,className:`edit-cancel-button`,children:`âœ•`})]}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(`span`,{className:`info-value`,children:g.email}),(0,m.jsx)(`button`,{onClick:()=>H(`email`,g.email),className:`edit-button`,children:`âœï¸`})]})})]})}),(0,m.jsx)(`div`,{className:`info-item`,children:(0,m.jsxs)(`div`,{className:`info-row`,children:[(0,m.jsx)(`span`,{className:`info-label`,children:`Phone Number:`}),(0,m.jsx)(`div`,{className:`info-value-container`,children:b===`phoneNumber`?(0,m.jsxs)(`div`,{className:`edit-form`,children:[(0,m.jsx)(`input`,{type:`tel`,value:S,onChange:e=>C(e.target.value),className:`edit-input`}),(0,m.jsx)(`button`,{onClick:U,className:`edit-save-button`,children:`âœ“`}),(0,m.jsx)(`button`,{onClick:W,className:`edit-cancel-button`,children:`âœ•`})]}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(`span`,{className:`info-value`,children:g.phoneNumber}),(0,m.jsx)(`button`,{onClick:()=>H(`phoneNumber`,g.phoneNumber),className:`edit-button`,children:`âœï¸`})]})})]})}),(0,m.jsx)(`div`,{className:`info-item`,children:(0,m.jsxs)(`div`,{className:`info-row`,children:[(0,m.jsx)(`span`,{className:`info-label`,children:`MoMo Number:`}),(0,m.jsx)(`div`,{className:`info-value-container`,children:b===`momoNumber`?(0,m.jsxs)(`div`,{className:`edit-form`,children:[(0,m.jsx)(`input`,{type:`text`,value:S,onChange:e=>{let t=e.target.value.replace(/[^0-9]/g,``);C(t)},className:`edit-input`}),(0,m.jsx)(`button`,{onClick:U,className:`edit-save-button`,children:`âœ“`}),(0,m.jsx)(`button`,{onClick:W,className:`edit-cancel-button`,children:`âœ•`})]}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(`span`,{className:`info-value`,children:g.momoNumber||`N/A`}),(0,m.jsx)(`button`,{onClick:()=>H(`momoNumber`,g.momoNumber),className:`edit-button`,children:`âœï¸`})]})})]})}),(0,m.jsx)(`div`,{className:`info-item`,children:(0,m.jsxs)(`div`,{className:`info-row`,children:[(0,m.jsx)(`span`,{className:`info-label`,children:`Credit Card Number:`}),(0,m.jsx)(`div`,{className:`info-value-container`,children:b===`creditCardNumber`?(0,m.jsxs)(`div`,{className:`edit-form`,children:[(0,m.jsx)(`input`,{type:`text`,value:S,onChange:e=>{let t=e.target.value.replace(/[^0-9]/g,``);C(t)},className:`edit-input`}),(0,m.jsx)(`button`,{onClick:U,className:`edit-save-button`,children:`âœ“`}),(0,m.jsx)(`button`,{onClick:W,className:`edit-cancel-button`,children:`âœ•`})]}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(`span`,{className:`info-value`,children:g.creditCardNumber?`â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ `+g.creditCardNumber.slice(-4):`N/A`}),(0,m.jsx)(`button`,{onClick:()=>H(`creditCardNumber`,g.creditCardNumber),className:`edit-button`,children:`âœï¸`})]})})]})}),(0,m.jsx)(`div`,{className:`info-item`,children:(0,m.jsxs)(`div`,{className:`info-row`,children:[(0,m.jsx)(`span`,{className:`info-label`,children:`Gender:`}),(0,m.jsx)(`div`,{className:`info-value-container`,children:b===`gender`?(0,m.jsxs)(`div`,{className:`edit-form`,children:[(0,m.jsxs)(`select`,{value:S,onChange:e=>C(e.target.value),className:`edit-input`,children:[(0,m.jsx)(`option`,{value:`male`,children:`Male`}),(0,m.jsx)(`option`,{value:`female`,children:`Female`})]}),(0,m.jsx)(`button`,{onClick:U,className:`edit-save-button`,children:`âœ“`}),(0,m.jsx)(`button`,{onClick:W,className:`edit-cancel-button`,children:`âœ•`})]}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(`span`,{className:`info-value capitalize`,children:g.gender}),(0,m.jsx)(`button`,{onClick:()=>H(`gender`,g.gender),className:`edit-button`,children:`âœï¸`})]})})]})})]})]}),(0,m.jsxs)(`div`,{className:`action-buttons`,children:[(0,m.jsxs)(`button`,{onClick:()=>h(!0),className:`btn btn-secondary`,children:[(0,m.jsx)(`span`,{className:`button-icon`,children:`âœï¸`}),`Edit Full Profile`]}),(0,m.jsxs)(`button`,{onClick:async()=>{try{await l()}catch(e){console.error(`Failed to logout`,e)}},className:`btn btn-danger`,children:[(0,m.jsx)(`span`,{className:`button-icon`,children:`ðŸšª`}),`Logout`]})]})]})]})})})};export{h as default};