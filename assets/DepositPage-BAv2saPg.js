import{_ as e,a as t,c as n,f as r,i,n as a,o,r as s,s as c,t as l,v as u}from"./index-CLweDl6A.js";var d=u(e()),f=u(a());function p(){let{currentUser:e}=l(),[a,u]=(0,d.useState)(``),[p,m]=(0,d.useState)(``),[h,g]=(0,d.useState)(null),[_,v]=(0,d.useState)(null),[y,b]=(0,d.useState)(!1),[x,S]=(0,d.useState)(``),[C,w]=(0,d.useState)(``),[T,E]=(0,d.useState)([]),[D,O]=(0,d.useState)(!0),[k,A]=(0,d.useState)(null);(0,d.useEffect)(()=>{(async()=>{if(e){O(!0);try{let r=await n(t(s,`deposits`)),i=[];r.forEach(t=>{let n={id:t.id,...t.data()};n.userId===e.uid&&i.push(n)}),i.sort((e,t)=>e.timestamp?t.timestamp?t.timestamp.toDate()-e.timestamp.toDate():-1:1),E(i)}catch(e){console.error(`Error fetching deposits:`,e),w(`Failed to load deposit history`)}finally{O(!1)}}})()},[e]);let j=e=>{let t=e.target.files[0];if(t){if(![`image/jpeg`,`image/png`,`image/webp`].includes(t.type)){w(`Only JPG/PNG/WebP images are allowed`);return}g(t),v(URL.createObjectURL(t))}},M=async o=>{if(o.preventDefault(),!a||!p||!h){w(`Please fill all fields and upload an image`);return}b(!0),w(``),S(``);try{let o=new FormData;o.append(`file`,h),o.append(`upload_preset`,`Shop-preset`);let c=await(await fetch(`https://api.cloudinary.com/v1_1/dlrxomdfh/image/upload`,{method:`POST`,body:o})).json();if(!c.secure_url)throw Error(`Image upload failed`);await i(t(s,`deposits`),{userId:e.uid,amount:parseFloat(a),message:p,imageUrl:c.secure_url,timestamp:r(),status:`pending`}),u(``),m(``),g(null),v(null),S(`Deposit submitted successfully!`);let l=await n(t(s,`deposits`)),d=[];l.forEach(t=>{let n={id:t.id,...t.data()};n.userId===e.uid&&d.push(n)}),d.sort((e,t)=>e.timestamp?t.timestamp?t.timestamp.toDate()-e.timestamp.toDate():-1:1),E(d)}catch(e){console.error(e),w(e.message||`Failed to submit deposit`)}finally{b(!1)}},N=async e=>{A(e),w(``),S(``);try{await o(c(s,`deposits`,e)),E(T.filter(t=>t.id!==e)),S(`Deposit deleted successfully!`)}catch(e){console.error(`Error deleting deposit:`,e),w(`Failed to delete deposit. Please try again.`)}finally{A(null)}},P=e=>{if(!e)return``;let t=e.toDate(),n=t.getHours().toString().padStart(2,`0`),r=t.getMinutes().toString().padStart(2,`0`),i=t.getDate(),a=t.toLocaleString(`default`,{month:`short`});return`${n}:${r} · ${i} ${a}`};return(0,f.jsx)(`div`,{className:`whatsapp-container`,children:(0,f.jsxs)(`div`,{className:`chat-container`,children:[C&&(0,f.jsx)(`div`,{className:`alert alert-error`,children:C}),x&&(0,f.jsxs)(`div`,{className:`alert alert-success`,children:[(0,f.jsx)(`span`,{className:`alert-success-icon`,children:`✓✓`}),` `,x]}),D?(0,f.jsx)(`div`,{className:`loading-indicator`,children:(0,f.jsxs)(`div`,{className:`loading-dots`,children:[(0,f.jsx)(`div`,{className:`loading-dot`}),(0,f.jsx)(`div`,{className:`loading-dot`}),(0,f.jsx)(`div`,{className:`loading-dot`})]})}):T.length===0?(0,f.jsx)(`div`,{className:`empty-state`,children:`No deposit history yet`}):T.map(e=>(0,f.jsx)(`div`,{className:`message-bubble`,children:(0,f.jsx)(`div`,{className:`message-bubble-content`,children:(0,f.jsxs)(`div`,{className:`message-bubble-bg`,children:[e.imageUrl&&(0,f.jsx)(`div`,{children:(0,f.jsx)(`img`,{src:e.imageUrl,alt:`Deposit receipt`,className:`message-image`})}),(0,f.jsxs)(`div`,{className:`message-text`,children:[(0,f.jsxs)(`p`,{className:`message-amount`,children:[`$`,e.amount]}),(0,f.jsx)(`p`,{className:`message-note`,children:e.message}),(0,f.jsx)(`p`,{className:`message-timestamp`,children:P(e.timestamp)}),(0,f.jsx)(`div`,{className:`deposit-actions`,children:(0,f.jsx)(`button`,{onClick:()=>N(e.id),disabled:k===e.id,className:`delete-button`,children:k===e.id?(0,f.jsx)(`span`,{className:`spinner`}):`Delete`})})]})]})})},e.id)),(0,f.jsxs)(`div`,{className:`form-container`,children:[(0,f.jsx)(`h2`,{className:`form-title`,children:`Submit New Deposit`}),(0,f.jsxs)(`form`,{onSubmit:M,className:`form-group`,children:[(0,f.jsx)(`input`,{type:`number`,placeholder:`Amount deposited`,value:a,onChange:e=>u(e.target.value),className:`form-input`,min:`0`,step:`0.01`,required:!0}),(0,f.jsx)(`input`,{type:`text`,placeholder:`Message`,value:p,onChange:e=>m(e.target.value),className:`form-input`}),(0,f.jsx)(`input`,{type:`file`,accept:`image/*`,onChange:j,className:`form-input`}),_&&(0,f.jsx)(`img`,{src:_,alt:`Preview`,className:`image-preview`}),(0,f.jsx)(`button`,{type:`submit`,disabled:y,className:`form-button`,children:y?`Submitting...`:`Submit Deposit`})]})]})]})})}export{p as default};