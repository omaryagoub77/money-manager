import{a as e,d as t,f as n,h as r,i,l as a,n as o,r as s,t as c,v as l,y as u}from"./index-6XTB6nXq.js";import{t as d}from"./Alert-BNppZvWJ.js";/* empty css              */var f=u(l()),p=u(o()),m=()=>{let{currentUser:o}=c(),[l,u]=(0,f.useState)(``),[m,h]=(0,f.useState)(``),[g,_]=(0,f.useState)(``),[v,y]=(0,f.useState)([]),[b,x]=(0,f.useState)(!1),[S,C]=(0,f.useState)(``),[w,T]=(0,f.useState)(``),[E,D]=(0,f.useState)(!0);(0,f.useEffect)(()=>{if(!o)return;let n=t(e(s,`loans`),r(`userId`,`==`,o.uid)),i=a(n,e=>{let t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),t.sort((e,t)=>{let n=e.timestamp?.toDate?.()||new Date(0);return(t.timestamp?.toDate?.()||new Date(0))-n}),y(t),D(!1)},t=>{console.error(`Error fetching cashout requests:`,t);let n=a(e(s,`loans`),e=>{let t=[];e.forEach(e=>{let n=e.data();n.userId===o.uid&&t.push({id:e.id,...n})}),t.sort((e,t)=>{let n=e.timestamp?.toDate?.()||new Date(0);return(t.timestamp?.toDate?.()||new Date(0))-n}),y(t),D(!1)});return()=>n()});return()=>i()},[o]);let O=async t=>{if(t.preventDefault(),!l||!m||!g){C(`Please fill in all fields`);return}if(parseFloat(l)<=0){C(`Amount must be greater than 0`);return}x(!0),C(``),T(``);try{await i(e(s,`loans`),{userId:o.uid,amount:parseFloat(l),name:m,reason:g,status:`pending`,timestamp:n()}),u(``),h(``),_(``),T(`Cashout request submitted successfully!`)}catch(e){console.error(`Error submitting cashout request:`,e),C(`Failed to submit cashout request. Please try again.`)}finally{x(!1)}},k=e=>{switch(e){case`accepted`:return`status-accepted`;case`denied`:return`status-denied`;case`pending`:default:return`status-pending`}},A=e=>{if(!e)return`N/A`;let t=e.toDate(),n=t.getHours().toString().padStart(2,`0`),r=t.getMinutes().toString().padStart(2,`0`),i=t.getDate(),a=t.toLocaleString(`default`,{month:`short`});return`${n}:${r} Â· ${i} ${a}`};return(0,p.jsx)(`div`,{className:`whatsapp-container`,children:(0,p.jsxs)(`div`,{className:`main-content`,children:[(0,p.jsx)(`h1`,{className:`page-title`,children:`Loan Request`}),S&&(0,p.jsx)(d,{type:`error`,message:S}),w&&(0,p.jsx)(d,{type:`success`,message:w}),(0,p.jsxs)(`div`,{className:`card animate-slideUp`,children:[(0,p.jsx)(`h2`,{className:`card-title`,children:`New Request`}),(0,p.jsxs)(`form`,{onSubmit:O,className:`form-group`,children:[(0,p.jsxs)(`div`,{children:[(0,p.jsx)(`label`,{className:`form-label`,children:`Amount`}),(0,p.jsx)(`input`,{type:`number`,value:l,onChange:e=>u(e.target.value),className:`form-input`,placeholder:`Enter amount`,min:`0`,step:`0.01`})]}),(0,p.jsxs)(`div`,{children:[(0,p.jsx)(`label`,{className:`form-label`,children:`Your Name`}),(0,p.jsx)(`input`,{type:`text`,value:m,onChange:e=>h(e.target.value),className:`form-input`,placeholder:`Enter your name`})]}),(0,p.jsxs)(`div`,{children:[(0,p.jsx)(`label`,{className:`form-label`,children:`Reason`}),(0,p.jsx)(`textarea`,{value:g,onChange:e=>_(e.target.value),className:`form-textarea`,placeholder:`Enter reason for cashout`,rows:`3`})]}),(0,p.jsx)(`button`,{type:`submit`,disabled:b,className:`form-button`,children:b?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(`div`,{className:`spinner`}),`Sending...`]}):`Send Request`})]})]}),(0,p.jsxs)(`div`,{className:`card`,children:[(0,p.jsx)(`h2`,{className:`card-title`,children:`Your Requests`}),E?(0,p.jsx)(`div`,{className:`loading-indicator`,children:(0,p.jsxs)(`div`,{className:`loading-dots`,children:[(0,p.jsx)(`div`,{className:`loading-dot`}),(0,p.jsx)(`div`,{className:`loading-dot`}),(0,p.jsx)(`div`,{className:`loading-dot`})]})}):v.length===0?(0,p.jsx)(`p`,{className:`empty-state`,children:`No cashout requests found`}):(0,p.jsx)(`div`,{className:`request-list`,children:v.map(e=>(0,p.jsxs)(`div`,{className:`request-item animate-slideUp`,children:[(0,p.jsxs)(`div`,{className:`request-header`,children:[(0,p.jsxs)(`div`,{className:`request-info`,children:[(0,p.jsxs)(`h3`,{children:[`Amount: $`,e.amount]}),(0,p.jsxs)(`p`,{children:[`Name: `,e.name]}),(0,p.jsxs)(`p`,{children:[`Reason: `,e.reason]})]}),(0,p.jsx)(`div`,{className:`request-status ${k(e.status)}`,children:e.status})]}),(0,p.jsxs)(`div`,{className:`request-footer`,children:[`Requested on `,A(e.timestamp)]})]},e.id))})]})]})})};export{m as default};