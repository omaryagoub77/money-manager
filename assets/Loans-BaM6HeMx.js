import{_ as e,a as t,d as n,f as r,i,l as a,m as o,n as s,o as c,r as l,v as u}from"./index-BtQzElyV.js";var d=u(e()),f=u(l()),p=()=>{let{currentUser:e}=s(),[l,u]=(0,d.useState)(``),[p,m]=(0,d.useState)(``),[h,g]=(0,d.useState)(``),[_,v]=(0,d.useState)([]),[y,b]=(0,d.useState)(!1),[x,S]=(0,d.useState)(``),[C,w]=(0,d.useState)(``),[T,E]=(0,d.useState)(!0);(0,d.useEffect)(()=>{if(!e)return;let t=n(c(i,`loans`),o(`userId`,`==`,e.uid)),r=a(t,e=>{let t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),t.sort((e,t)=>{let n=e.timestamp?.toDate?.()||new Date(0);return(t.timestamp?.toDate?.()||new Date(0))-n}),v(t),E(!1)},t=>{console.error(`Error fetching cashout requests:`,t);let n=a(c(i,`loans`),t=>{let n=[];t.forEach(t=>{let r=t.data();r.userId===e.uid&&n.push({id:t.id,...r})}),n.sort((e,t)=>{let n=e.timestamp?.toDate?.()||new Date(0);return(t.timestamp?.toDate?.()||new Date(0))-n}),v(n),E(!1)});return()=>n()});return()=>r()},[e]);let D=async n=>{if(n.preventDefault(),!l||!p||!h){S(`Please fill in all fields`);return}if(parseFloat(l)<=0){S(`Amount must be greater than 0`);return}b(!0),S(``),w(``);try{await t(c(i,`loans`),{userId:e.uid,amount:parseFloat(l),name:p,reason:h,status:`pending`,timestamp:r()}),Accepted,u(``),m(``),g(``),w(`Cashout request submitted successfully!`)}catch(e){console.error(`Error submitting cashout request:`,e),S(`Failed to submit cashout request. Please try again.`)}finally{b(!1)}},O=e=>{switch(e){case`accepted`:return`status-accepted`;case`denied`:return`status-denied`;case`pending`:default:return`status-pending`}},k=e=>{if(!e)return`N/A`;let t=e.toDate(),n=t.getHours().toString().padStart(2,`0`),r=t.getMinutes().toString().padStart(2,`0`),i=t.getDate(),a=t.toLocaleString(`default`,{month:`short`});return`${n}:${r} Â· ${i} ${a}`};return(0,f.jsx)(`div`,{className:`whatsapp-container`,children:(0,f.jsxs)(`div`,{className:`main-content`,children:[(0,f.jsx)(`h1`,{className:`page-title`,children:`Loan Request`}),(0,f.jsxs)(`div`,{className:`card animate-slideUp`,children:[(0,f.jsx)(`h2`,{className:`card-title`,children:`New Request`}),(0,f.jsxs)(`form`,{onSubmit:D,className:`form-group`,children:[x&&(0,f.jsx)(`div`,{className:`alert alert-error`,children:x}),C&&(0,f.jsx)(`div`,{className:`alert alert-success`,children:C}),(0,f.jsxs)(`div`,{children:[(0,f.jsx)(`label`,{className:`form-label`,children:`Amount`}),(0,f.jsx)(`input`,{type:`number`,value:l,onChange:e=>u(e.target.value),className:`form-input`,placeholder:`Enter amount`,min:`0`,step:`0.01`})]}),(0,f.jsxs)(`div`,{children:[(0,f.jsx)(`label`,{className:`form-label`,children:`Your Name`}),(0,f.jsx)(`input`,{type:`text`,value:p,onChange:e=>m(e.target.value),className:`form-input`,placeholder:`Enter your name`})]}),(0,f.jsxs)(`div`,{children:[(0,f.jsx)(`label`,{className:`form-label`,children:`Reason`}),(0,f.jsx)(`textarea`,{value:h,onChange:e=>g(e.target.value),className:`form-textarea`,placeholder:`Enter reason for cashout`,rows:`3`})]}),(0,f.jsx)(`button`,{type:`submit`,disabled:y,className:`form-button`,children:y?`Sending...`:`Send Request`})]})]}),(0,f.jsxs)(`div`,{className:`card`,children:[(0,f.jsx)(`h2`,{className:`card-title`,children:`Your Requests`}),T?(0,f.jsx)(`div`,{className:`loading-indicator`,children:(0,f.jsxs)(`div`,{className:`loading-dots`,children:[(0,f.jsx)(`div`,{className:`loading-dot`}),(0,f.jsx)(`div`,{className:`loading-dot`}),(0,f.jsx)(`div`,{className:`loading-dot`})]})}):_.length===0?(0,f.jsx)(`p`,{className:`empty-state`,children:`No cashout requests found`}):(0,f.jsx)(`div`,{className:`request-list`,children:_.map(e=>(0,f.jsxs)(`div`,{className:`request-item animate-slideUp`,children:[(0,f.jsxs)(`div`,{className:`request-header`,children:[(0,f.jsxs)(`div`,{className:`request-info`,children:[(0,f.jsxs)(`h3`,{children:[`Amount: $`,e.amount]}),(0,f.jsxs)(`p`,{children:[`Name: `,e.name]}),(0,f.jsxs)(`p`,{children:[`Reason: `,e.reason]})]}),(0,f.jsx)(`div`,{className:`request-status ${O(e.status)}`,children:e.status})]}),(0,f.jsxs)(`div`,{className:`request-footer`,children:[`Requested on `,k(e.timestamp)]})]},e.id))})]})]})})};export{p as default};