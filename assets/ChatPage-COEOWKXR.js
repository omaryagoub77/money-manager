import{a as e,b as t,c as n,d as r,f as i,h as a,i as o,m as s,n as c,o as l,p as u,r as d,s as f,u as p,y as m}from"./index-Du5Zpax2.js";var h=t(m()),g=t(d());function _(){let{currentUser:t}=c(),[d,m]=(0,h.useState)([]),[_,v]=(0,h.useState)(``),[y,b]=(0,h.useState)(!0),[x,S]=(0,h.useState)({}),C=(0,h.useRef)(),w=(0,h.useRef)(null);(0,h.useEffect)(()=>{if(!t)return;(async()=>{try{let e=f(o,`users`,t.uid);(await n(e)).exists()?await a(e,{isOnline:!0,lastActive:u()}):await s(e,{isOnline:!0,lastActive:u(),email:t.email,displayName:t.email.split(`@`)[0]})}catch(e){console.error(`Error setting user online:`,e)}})(),w.current=setInterval(async()=>{try{let e=f(o,`users`,t.uid);await a(e,{lastActive:u()})}catch(e){console.error(`Error updating presence:`,e)}},3e4);let e=async()=>{try{let e=f(o,`users`,t.uid);await a(e,{isOnline:!1,lastActive:u()})}catch(e){console.error(`Error setting user offline:`,e)}};return window.addEventListener(`beforeunload`,e),()=>{w.current&&clearInterval(w.current),window.removeEventListener(`beforeunload`,e),e()}},[t]),(0,h.useEffect)(()=>{if(!t)return;let e=i(l(o,`messages`),r(`timestamp`,`asc`)),n=p(e,e=>{m(e.docs.map(e=>({id:e.id,...e.data()}))),b(!1)}),a=l(o,`users`),s=p(a,e=>{let t={};e.forEach(e=>{let n=e.data();t[e.id]={isOnline:n.isOnline||!1,lastActive:n.lastActive,displayName:n.displayName||n.email?.split(`@`)[0]||`Unknown`}}),S(t)});return()=>{n(),s()}},[t]);let T=async n=>{if(n.preventDefault(),_.trim())try{await e(l(o,`messages`),{text:_,userId:t.uid,userName:t.email.split(`@`)[0],timestamp:u()}),v(``)}catch(e){console.error(`Error sending message:`,e)}};(0,h.useEffect)(()=>{C.current?.scrollIntoView({behavior:`smooth`})},[d]);let E=e=>e?e.toDate().toLocaleTimeString([],{hour:`2-digit`,minute:`2-digit`}):``,D=()=>Object.entries(x).filter(([e,t])=>t.isOnline).sort(([e,t],[n,r])=>t.displayName.localeCompare(r.displayName));return(0,g.jsxs)(`div`,{className:`chat-container`,children:[(0,g.jsxs)(`div`,{className:`chat-header`,children:[(0,g.jsxs)(`div`,{className:`chat-header-avatar`,children:[t?.email?.charAt(0).toUpperCase()||`U`,(0,g.jsx)(`div`,{className:`online-status-indicator ${x[t?.uid]?.isOnline?`online`:`offline`}`,title:x[t?.uid]?.isOnline?`Online`:`Offline`})]}),(0,g.jsxs)(`div`,{className:`chat-header-info`,children:[(0,g.jsx)(`h1`,{children:`Chat Room`}),(0,g.jsxs)(`p`,{children:[d.length,` Messages`]})]})]}),(0,g.jsxs)(`div`,{className:`online-users-bar`,children:[(0,g.jsx)(`div`,{className:`online-users-label`,children:`Online Now:`}),(0,g.jsxs)(`div`,{className:`online-users-list`,children:[D().map(([e,t])=>(0,g.jsxs)(`div`,{className:`online-user`,children:[(0,g.jsxs)(`div`,{className:`online-user-avatar`,children:[t.displayName.charAt(0).toUpperCase(),(0,g.jsx)(`div`,{className:`online-status-indicator online`,title:`Online`})]}),(0,g.jsx)(`span`,{className:`online-user-name`,children:t.displayName})]},e)),D().length===0&&(0,g.jsx)(`div`,{className:`no-online-users`,children:`No users online`})]})]}),(0,g.jsxs)(`div`,{className:`messages-container`,children:[y?(0,g.jsx)(`div`,{className:`loading-indicator`,children:(0,g.jsxs)(`div`,{className:`loading-dots`,children:[(0,g.jsx)(`div`,{className:`loading-dot`}),(0,g.jsx)(`div`,{className:`loading-dot`}),(0,g.jsx)(`div`,{className:`loading-dot`})]})}):d.length===0?(0,g.jsxs)(`div`,{className:`empty-state`,children:[(0,g.jsx)(`div`,{className:`empty-state-icon`,children:`ðŸ’¬`}),(0,g.jsx)(`div`,{className:`empty-state-text`,children:`No messages yet. Start a conversation!`})]}):d.map(e=>(0,g.jsxs)(`div`,{className:`message ${e.userId===t.uid?`message-sent`:`message-received`}`,children:[e.userId!==t.uid&&(0,g.jsxs)(`div`,{className:`message-avatar message-avatar-received`,children:[e.userName.charAt(0).toUpperCase(),(0,g.jsx)(`div`,{className:`online-status-indicator ${x[e.userId]?.isOnline?`online`:`offline`}`,title:x[e.userId]?.isOnline?`Online`:`Offline`})]}),(0,g.jsxs)(`div`,{className:`message-bubble ${e.userId===t.uid?`message-bubble-sent`:`message-bubble-received`}`,children:[(0,g.jsx)(`div`,{className:`message-text`,children:e.text}),(0,g.jsx)(`div`,{className:`message-timestamp`,children:E(e.timestamp)})]}),e.userId===t.uid&&(0,g.jsxs)(`div`,{className:`message-avatar message-avatar-sent`,children:[e.userName.charAt(0).toUpperCase(),(0,g.jsx)(`div`,{className:`online-status-indicator ${x[e.userId]?.isOnline?`online`:`offline`}`,title:x[e.userId]?.isOnline?`Online`:`Offline`})]})]},e.id)),(0,g.jsx)(`div`,{ref:C})]}),(0,g.jsxs)(`form`,{onSubmit:T,className:`input-container`,children:[(0,g.jsx)(`div`,{className:`input-wrapper`,children:(0,g.jsx)(`input`,{type:`text`,className:`message-input`,placeholder:`Type a message...`,value:_,onChange:e=>v(e.target.value)})}),(0,g.jsx)(`button`,{type:`submit`,className:`send-button`,disabled:!_.trim(),children:(0,g.jsx)(`svg`,{xmlns:`http://www.w3.org/2000/svg`,viewBox:`0 0 24 24`,fill:`currentColor`,className:`send-icon`,children:(0,g.jsx)(`path`,{d:`M3.478 2.404a.75.75 0 0 0-.926.941l2.432 7.905H13.5a.75.75 0 0 1 0 1.5H4.984l-2.432 7.905a.75.75 0 0 0 .926.94 60.519 60.519 0 0 0 18.445-8.986.75.75 0 0 0 0-1.218A60.517 60.517 0 0 0 3.478 2.404Z`})})})]})]})}var v=()=>(0,g.jsx)(`div`,{style:{marginTop:`20px`},children:(0,g.jsx)(_,{})});export{v as default};