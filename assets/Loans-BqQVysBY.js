import{a as e,b as t,f as n,g as r,i,n as a,o,p as s,r as c,t as l,u,y as d}from"./index-Du5Zpax2.js";import{t as f}from"./Alert-AD00m8FJ.js";var p=t(d()),m=t(c()),h=()=>{let{currentUser:t}=a(),[c,d]=(0,p.useState)(``),[h,g]=(0,p.useState)(``),[_,v]=(0,p.useState)(``),[y,b]=(0,p.useState)([]),[x,S]=(0,p.useState)(!1),[C,w]=(0,p.useState)(``),[T,E]=(0,p.useState)(``),[D,O]=(0,p.useState)(!0);(0,p.useEffect)(()=>{if(!t)return;let e=n(o(i,`loans`),r(`userId`,`==`,t.uid)),a=u(e,e=>{let t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),t.sort((e,t)=>{let n=e.timestamp?.toDate?.()||new Date(0);return(t.timestamp?.toDate?.()||new Date(0))-n}),b(t),O(!1)},e=>{console.error(`Error fetching cashout requests:`,e);let n=u(o(i,`loans`),e=>{let n=[];e.forEach(e=>{let r=e.data();r.userId===t.uid&&n.push({id:e.id,...r})}),n.sort((e,t)=>{let n=e.timestamp?.toDate?.()||new Date(0);return(t.timestamp?.toDate?.()||new Date(0))-n}),b(n),O(!1)});return()=>n()});return()=>a()},[t]);let k=async n=>{if(n.preventDefault(),!c||!h||!_){w(`Please fill in all fields`);return}if(parseFloat(c)<=0){w(`Amount must be greater than 0`);return}S(!0),w(``),E(``);try{await e(o(i,`loans`),{userId:t.uid,amount:parseFloat(c),name:h,reason:_,status:`pending`,timestamp:s()}),d(``),g(``),v(``),E(`Cashout request submitted successfully!`)}catch(e){console.error(`Error submitting cashout request:`,e),w(`Failed to submit cashout request. Please try again.`)}finally{S(!1)}},A=e=>{switch(e){case`accepted`:return`status-accepted`;case`denied`:return`status-denied`;case`pending`:default:return`status-pending`}},j=e=>{if(!e)return`N/A`;let t=e.toDate(),n=t.getHours().toString().padStart(2,`0`),r=t.getMinutes().toString().padStart(2,`0`),i=t.getDate(),a=t.toLocaleString(`default`,{month:`short`});return`${n}:${r} Â· ${i} ${a}`};return(0,m.jsxs)(`div`,{className:`whatsapp-container`,children:[(0,m.jsx)(l,{}),(0,m.jsxs)(`div`,{className:`main-content`,children:[(0,m.jsx)(`h1`,{className:`page-title`,children:`Loan Request`}),C&&(0,m.jsx)(f,{type:`error`,message:C}),T&&(0,m.jsx)(f,{type:`success`,message:T}),(0,m.jsxs)(`div`,{className:`card animate-slideUp`,children:[(0,m.jsx)(`h2`,{className:`card-title`,children:`New Request`}),(0,m.jsxs)(`form`,{onSubmit:k,className:`form-group`,children:[(0,m.jsxs)(`div`,{children:[(0,m.jsx)(`label`,{className:`form-label`,children:`Amount`}),(0,m.jsx)(`input`,{type:`number`,value:c,onChange:e=>d(e.target.value),className:`form-input`,placeholder:`Enter amount`,min:`0`,step:`0.01`})]}),(0,m.jsxs)(`div`,{children:[(0,m.jsx)(`label`,{className:`form-label`,children:`Your Name`}),(0,m.jsx)(`input`,{type:`text`,value:h,onChange:e=>g(e.target.value),className:`form-input`,placeholder:`Enter your name`})]}),(0,m.jsxs)(`div`,{children:[(0,m.jsx)(`label`,{className:`form-label`,children:`Reason`}),(0,m.jsx)(`textarea`,{value:_,onChange:e=>v(e.target.value),className:`form-textarea`,placeholder:`Enter reason for cashout`,rows:`3`})]}),(0,m.jsx)(`button`,{type:`submit`,disabled:x,className:`form-button`,children:x?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(`div`,{className:`spinner`}),`Sending...`]}):`Send Request`})]})]}),(0,m.jsxs)(`div`,{className:`card`,children:[(0,m.jsx)(`h2`,{className:`card-title`,children:`Your Requests`}),D?(0,m.jsx)(`div`,{className:`loading-indicator`,children:(0,m.jsxs)(`div`,{className:`loading-dots`,children:[(0,m.jsx)(`div`,{className:`loading-dot`}),(0,m.jsx)(`div`,{className:`loading-dot`}),(0,m.jsx)(`div`,{className:`loading-dot`})]})}):y.length===0?(0,m.jsx)(`p`,{className:`empty-state`,children:`No cashout requests found`}):(0,m.jsx)(`div`,{className:`request-list`,children:y.map(e=>(0,m.jsxs)(`div`,{className:`request-item animate-slideUp`,children:[(0,m.jsxs)(`div`,{className:`request-header`,children:[(0,m.jsxs)(`div`,{className:`request-info`,children:[(0,m.jsxs)(`h3`,{children:[`Amount: $`,e.amount]}),(0,m.jsxs)(`p`,{children:[`Name: `,e.name]}),(0,m.jsxs)(`p`,{children:[`Reason: `,e.reason]})]}),(0,m.jsx)(`div`,{className:`request-status ${A(e.status)}`,children:e.status})]}),(0,m.jsxs)(`div`,{className:`request-footer`,children:[`Requested on `,j(e.timestamp)]})]},e.id))})]})]})]})};export{h as default};