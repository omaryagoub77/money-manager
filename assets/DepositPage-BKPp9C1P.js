import{_ as e,a as t,c as n,f as r,i,n as a,o,r as s,v as c}from"./index-DfMKtKQ8.js";import{t as l}from"./Alert-DFyOwRvx.js";var u=c(e()),d=c(s());function f(){let{currentUser:e}=a(),[s,c]=(0,u.useState)(``),[f,p]=(0,u.useState)(``),[m,h]=(0,u.useState)(null),[g,_]=(0,u.useState)(null),[v,y]=(0,u.useState)(!1),[b,x]=(0,u.useState)(``),[S,C]=(0,u.useState)(``),[w,T]=(0,u.useState)([]),[E,D]=(0,u.useState)(!0);(0,u.useEffect)(()=>{(async()=>{if(e){D(!0);try{let t=await n(o(i,`deposits`)),r=[];t.forEach(t=>{let n={id:t.id,...t.data()};n.userId===e.uid&&r.push(n)}),r.sort((e,t)=>e.timestamp?t.timestamp?t.timestamp.toDate()-e.timestamp.toDate():-1:1),T(r)}catch(e){console.error(`Error fetching deposits:`,e),C(`Failed to load deposit history`)}finally{D(!1)}}})()},[e]);let O=e=>{let t=e.target.files[0];if(t){if(![`image/jpeg`,`image/png`,`image/webp`].includes(t.type)){C(`Only JPG/PNG/WebP images are allowed`);return}h(t),_(URL.createObjectURL(t))}},k=async a=>{if(a.preventDefault(),!s||!f||!m){C(`Please fill all fields and upload an image`);return}y(!0),x(``),C(``);try{let a=new FormData;a.append(`file`,m),a.append(`upload_preset`,`Shop-preset`);let l=await(await fetch(`https://api.cloudinary.com/v1_1/dlrxomdfh/image/upload`,{method:`POST`,body:a})).json();if(!l.secure_url)throw Error(`Image upload failed`);await t(o(i,`deposits`),{userId:e.uid,amount:parseFloat(s),message:f,imageUrl:l.secure_url,timestamp:r(),status:`pending`}),c(``),p(``),h(null),_(null),x(`Deposit submitted successfully!`);let u=await n(o(i,`deposits`)),d=[];u.forEach(t=>{let n={id:t.id,...t.data()};n.userId===e.uid&&d.push(n)}),d.sort((e,t)=>e.timestamp?t.timestamp?t.timestamp.toDate()-e.timestamp.toDate():-1:1),T(d)}catch(e){console.error(e),C(e.message||`Failed to submit deposit`)}finally{y(!1)}},A=e=>{switch(e){case`accepted`:return`status-accepted`;case`denied`:return`status-denied`;case`pending`:default:return`status-pending`}},j=e=>{if(!e)return``;let t=e.toDate(),n=t.getHours().toString().padStart(2,`0`),r=t.getMinutes().toString().padStart(2,`0`),i=t.getDate(),a=t.toLocaleString(`default`,{month:`short`});return`${n}:${r} Â· ${i} ${a}`};return(0,d.jsx)(`div`,{className:`whatsapp-container`,children:(0,d.jsxs)(`div`,{className:`chat-container`,children:[(0,d.jsxs)(`div`,{className:`form-container`,children:[(0,d.jsx)(`h2`,{className:`form-title`,children:`Submit New Deposit`}),(0,d.jsxs)(`form`,{onSubmit:k,className:`form-group`,children:[(0,d.jsx)(`input`,{type:`number`,placeholder:`Amount deposited`,value:s,onChange:e=>c(e.target.value),className:`form-input`,min:`0`,step:`0.01`,required:!0}),(0,d.jsx)(`input`,{type:`text`,placeholder:`Message`,value:f,onChange:e=>p(e.target.value),className:`form-input`}),(0,d.jsx)(`input`,{type:`file`,accept:`image/*`,onChange:O,className:`form-input`}),g&&(0,d.jsx)(`img`,{src:g,alt:`Preview`,className:`image-preview`}),(0,d.jsx)(`button`,{type:`submit`,disabled:v,className:`form-button`,children:v?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(`div`,{className:`spinner`}),`Submitting...`]}):`Submit Deposit`})]})]}),S&&(0,d.jsx)(l,{type:`error`,message:S}),b&&(0,d.jsx)(l,{type:`success`,message:b}),E?(0,d.jsx)(`div`,{className:`loading-indicator`,children:(0,d.jsxs)(`div`,{className:`loading-dots`,children:[(0,d.jsx)(`div`,{className:`loading-dot`}),(0,d.jsx)(`div`,{className:`loading-dot`}),(0,d.jsx)(`div`,{className:`loading-dot`})]})}):w.length===0?(0,d.jsx)(`div`,{className:`empty-state`,children:`No deposit history yet`}):w.map(e=>(0,d.jsx)(`div`,{className:`message-bubble`,children:(0,d.jsx)(`div`,{className:`message-bubble-content`,children:(0,d.jsxs)(`div`,{className:`message-bubble-bg`,children:[e.imageUrl&&(0,d.jsx)(`div`,{children:(0,d.jsx)(`img`,{src:e.imageUrl,alt:`Deposit receipt`,className:`message-image`})}),(0,d.jsxs)(`div`,{className:`message-text`,children:[(0,d.jsxs)(`p`,{className:`message-amount`,children:[`$`,e.amount]}),(0,d.jsx)(`p`,{className:`message-note`,children:e.message}),(0,d.jsx)(`div`,{className:`request-status ${A(e.status)}`,children:e.status}),`                    `,(0,d.jsx)(`p`,{className:`message-timestamp`,children:j(e.timestamp)})]})]})})},e.id))]})})}export{f as default};